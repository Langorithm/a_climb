<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$GODOT_PROJECT_NAME</title>
    <style>
        /* --- 1. Global Reset & Pixel Rendering --- */
        body {
            margin: 0;
            background-color: #1a1a2e;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* --- 2. Cloud Construction --- */
        .cloud-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .cloud {
            position: absolute;
            background: #ffffff;
            width: 40px; 
            height: 12px;
            animation: move linear infinite;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: inherit;
        }

        .shape-a::before { width: 20px; height: 20px; top: -10px; left: 10px; }
        .shape-b::before { width: 15px; height: 15px; top: -8px; left: 5px; }
        .shape-b::after { width: 15px; height: 10px; top: -5px; left: 22px; }
        .shape-c::before { width: 22px; height: 28px; top: -20px; left: 8px; }
        .shape-d { width: 65px; height: 8px; }
        .shape-d::before { width: 18px; height: 12px; top: -6px; left: 6px; }
        .shape-d::after { width: 22px; height: 10px; top: -4px; left: 35px; }
        .shape-e::before { width: 28px; height: 18px; top: -10px; left: -5px; }
        .shape-e::after { width: 12px; height: 12px; top: -4px; left: 24px; }

        @keyframes move {
            from { left: -300px; }
            to { left: 100vw; }
        }

        /* --- 3. UI & Branding --- */
        #ui-layer {
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #logo {
            width: 256px; /* Scaled up for the Kenney logo */
            height: auto;
            margin-bottom: 20px;
            image-rendering: pixelated;
        }

        #progress-container {
            width: 240px;
            height: 12px;
            background: #50334624;
            border: 1px solid #ffffff6d;
            padding: 2px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: #478bbff1;
            transition: width 0.1s;
        }

        /* Fallback animation if the file size is unknown */
        .indeterminate #progress-bar {
            width: 40% !important;
            animation: bypass 1.5s infinite linear;
        }

        @keyframes bypass {
            0% { margin-left: -40%; }
            100% { margin-left: 100%; }
        }

        /* --- 4. The Game Canvas --- */
        #canvas {
            display: block;
            position: absolute;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
            visibility: hidden;
            background: black;
        }
    </style>
</head>
<body>

    <div class="cloud-layer" id="clouds">
        <div class="cloud shape-a" style="top: 10%; opacity: 0.1; animation-duration: 80s; transform: scale(1);"></div>
        <div class="cloud shape-d" style="top: 35%; opacity: 0.1; animation-duration: 100s; animation-delay: -40s; transform: scale(1.2);"></div>
        <div class="cloud shape-c" style="top: 55%; opacity: 0.2; animation-duration: 50s; animation-delay: -15s; transform: scale(2);"></div>
        <div class="cloud shape-e" style="top: 20%; opacity: 0.2; animation-duration: 65s; animation-delay: -30s; transform: scale(1.7);"></div>
        <div class="cloud shape-b" style="top: 80%; opacity: 0.3; animation-duration: 35s; animation-delay: -10s; transform: scale(2.8);"></div>
        <div class="cloud shape-d" style="top: 65%; opacity: 0.25; animation-duration: 40s; transform: scale(3.5);"></div>
    </div>

    <div id="ui-layer">
        <img id="logo" src="https://raw.githubusercontent.com/KenneyNL/Godot-SplashScreens/refs/heads/main/Logo/Pixel/made-with-godot-light.png" alt="MADE WITH GODOT">
        <div id="progress-container"><div id="progress-bar"></div></div>
    </div>

    <canvas id="canvas"></canvas>

    <script src="$GODOT_URL"></script>
    <script>
        const engine = new Engine($GODOT_CONFIG);

        (function() {
            const ui = document.getElementById('ui-layer');
            const clouds = document.getElementById('clouds');
            const canvas = document.getElementById('canvas');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');

            engine.startGame({
                onProgress: function (current, total) {
                    if (total > 0) {
                        // Standard progress bar
                        progressContainer.classList.remove('indeterminate');
                        const pc = (current / total) * 100;
                        progressBar.style.width = pc + '%';
                    } else {
                        // Total is 0 or unknown, trigger the sliding animation
                        progressContainer.classList.add('indeterminate');
                    }
                }
            }).then(() => {
                ui.remove();
                clouds.remove();
                canvas.style.visibility = 'visible';
                canvas.focus();
            }).catch((err) => {
                console.error(err);
                // If it fails, at least try to show the error on the page
                document.body.innerHTML += `<div style="z-index:10; color:red;">Load Error: ${err.message}</div>`;
            });
        })();
    </script>
</body>
</html>